name: Test Workflow Dispatch

# Este workflow testa o comportamento do workflow_dispatch em diferentes branches
on:
  workflow_dispatch:
    inputs:
      test_scenario:
        description: "CenÃ¡rio de teste que vocÃª estÃ¡ executando"
        required: false
        default: "teste-basico"
        type: choice
        options:
          - teste-basico
          - teste-main-branch
          - teste-develop-branch
          - teste-feature-branch
      custom_message:
        description: "Mensagem personalizada para identificar o teste"
        required: false
        default: "Teste de workflow_dispatch"
        type: string

  # TambÃ©m vamos adicionar push para ver a diferenÃ§a
  push:
    branches: [main, develop]
    paths:
      - ".github/workflows/**"

jobs:
  test-dispatch:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do cÃ³digo
        uses: actions/checkout@v4

      - name: Mostrar informaÃ§Ãµes do contexto
        run: |
          echo "ğŸš€ INFORMAÃ‡Ã•ES DO WORKFLOW DISPATCH ğŸš€"
          echo "============================================"
          echo "ğŸ“… Data/Hora: $(date)"
          echo "ğŸŒ¿ Branch atual: ${{ github.ref_name }}"
          echo "ğŸ”€ Branch de origem: ${{ github.head_ref || github.ref_name }}"
          echo "âš¡ Evento que acionou: ${{ github.event_name }}"
          echo "ğŸ‘¤ UsuÃ¡rio que acionou: ${{ github.actor }}"
          echo "ğŸ¢ RepositÃ³rio: ${{ github.repository }}"
          echo "ğŸ†” Run ID: ${{ github.run_id }}"
          echo "ğŸ”¢ Run Number: ${{ github.run_number }}"
          echo "============================================"

      - name: Mostrar inputs do workflow_dispatch
        if: github.event_name == 'workflow_dispatch'
        run: |
          echo "ğŸ“ INPUTS DO WORKFLOW_DISPATCH ğŸ“"
          echo "=================================="
          echo "CenÃ¡rio de teste: ${{ github.event.inputs.test_scenario }}"
          echo "Mensagem personalizada: ${{ github.event.inputs.custom_message }}"
          echo "=================================="

      - name: Executar script de demonstraÃ§Ã£o
        run: |
          chmod +x ./scripts/show-branch-info.sh
          ./scripts/show-branch-info.sh

      - name: Executar script Python
        run: |
          python3 ./scripts/test-script.py

      - name: Mostrar arquivos do workflow
        run: |
          echo "ğŸ“ ARQUIVOS DE WORKFLOW PRESENTES ğŸ“"
          echo "===================================="
          ls -la .github/workflows/
          echo "===================================="
          echo "ğŸ“„ ConteÃºdo do arquivo atual:"
          echo "===================================="
          cat .github/workflows/test-dispatch.yml

      - name: Verificar diferenÃ§as por branch
        run: |
          echo "ğŸ” VERIFICAÃ‡ÃƒO ESPECÃFICA DA BRANCH ğŸ”"
          echo "======================================"
          case "${{ github.ref_name }}" in
            "main")
              echo "ğŸ¯ Executando na branch MAIN (ProduÃ§Ã£o)"
              echo "Esta Ã© a branch principal do projeto"
              ;;
            "develop")
              echo "ğŸ› ï¸ Executando na branch DEVELOP (Desenvolvimento)"
              echo "Esta Ã© a branch de desenvolvimento"
              ;;
            feat/*)
              echo "âœ¨ Executando na branch FEATURE (${{ github.ref_name }})"
              echo "Esta Ã© uma branch de feature temporÃ¡ria"
              ;;
            *)
              echo "â“ Executando em branch nÃ£o mapeada: ${{ github.ref_name }}"
              ;;
          esac

      - name: Salvar resultado do teste
        run: |
          echo "ğŸ’¾ SALVANDO RESULTADO DO TESTE ğŸ’¾"
          echo "================================="
          mkdir -p test-results
          cat > test-results/resultado-$(date +%Y%m%d-%H%M%S).txt << EOF
          TESTE WORKFLOW_DISPATCH - $(date)
          ===================================
          Branch: ${{ github.ref_name }}
          Evento: ${{ github.event_name }}
          Actor: ${{ github.actor }}
          CenÃ¡rio: ${{ github.event.inputs.test_scenario }}
          Mensagem: ${{ github.event.inputs.custom_message }}
          Run ID: ${{ github.run_id }}

          STATUS: âœ… WORKFLOW EXECUTADO COM SUCESSO
          ===================================
          EOF

      - name: Upload dos resultados
        uses: actions/upload-artifact@v4
        with:
          name: test-results-${{ github.ref_name }}-${{ github.run_number }}
          path: test-results/
          retention-days: 30
